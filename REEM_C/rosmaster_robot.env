# TODO: catch if this file is not sources
if [[ $_ == $0 ]]; then
  echo "You need to source this script to have the environment variables set"
fi

# find own IP on HCRL network
HCRL_NETWORK=192.168.1.
NETWORK_FOUND=0
for ip in $(hostname --all-ip-addresses); do
  if [[ $ip == ${HCRL_NETWORK}* ]]; then
	export ROS_IP=$ip
        echo ROS_IP=${ROS_IP}
        # when name resolution works use this
        #export ROS_HOSTNAME=$(dig +short -x $ROS_IP)
        export ROS_HOSTNAME=$ROS_IP
        echo ROS_HOSTNAME=${ROS_HOSTNAME}
        NETWORK_FOUND=1
  fi
done
if [[ "$NETWORK_FOUND" == "0" ]]; then
    echo "Not on HCRL network!"
    return
fi

export ROS_MASTER_URI=http://reemc-7c:11311

set +e
ping -W 1 -q -c 1 reemc-7c > /dev/null
if [ "$?" != "0" ]; then
	echo "Robot not reachable, execute add_route.sh outside of docker to fix that"
fi

if [ $UID -ne 0 ]; then
	PS1='\[\033[01;31m\]ROBOT ${debian_chroot:+($debian_chroot)}\[\e[36;1m\]\u\[\e[0m\]@docker\[\033[00m\]:\[\e[30;1m\]\w\[\e[0m\]\[\e[00;36m\]$(__git_ps1 " (%s)")\[\e[36;1m\]>\[\e[0m\]\[\e[1m\] '
else
	PS1='\[\033[01;31m\]ROBOT ${debian_chroot:+($debian_chroot)}\[\e[31;1m\]\u\[\e[0m\]@docker\[\033[00m\]:\[\e[30;1m\]\w\[\e[31;1m\]#\[\e[0m\]\[\e[1m\] '
fi
